<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Multiverso</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/estilos.css}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="container my-4">

<!-- Rick and Morty -->
<h2 class="mb-3">Rick and Morty</h2>
<div class="row" id="rick-section"></div>
<div class="d-flex justify-content-between my-3">
    <button id="rick-prev" class="btn btn-secondary">Anterior</button>
    <button id="rick-next" class="btn btn-primary">Siguiente</button>
</div>

<!-- Pokémon -->
<h2 class="mb-3">Pokémon</h2>
<div class="row" id="pokemon-section"></div>
<div class="d-flex justify-content-between my-3">
    <button id="poke-prev" class="btn btn-secondary">Anterior</button>
    <button id="poke-next" class="btn btn-primary">Siguiente</button>
</div>

<!-- Modal con Card -->
<div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 id="modal-title" class="mb-0">Detalle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="card-body text-center">
                    <img id="modal-img" class="img-fluid rounded mb-3" alt="imagen">
                    <h6 id="modal-name"></h6>
                    <span id="modal-universe" class="badge bg-info"></span>
                    <div id="modal-extra" class="mt-3 text-start"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function(){

        // Rick and Morty
        let rickPage = 1;
        function getRick(page){
            $.ajax({
                method: "GET", dataType: "json",
                url: `https://rickandmortyapi.com/api/character?page=${page}`
            }).done(function(data){
                $("#rick-section").empty();
                data.results.forEach(car => {
                    $("#rick-section").append(`
                      <div class="col-md-3 col-sm-6 mb-3">
                        <div class="card shadow-sm" data-api="rick" data-id="${car.id}">
                          <img src="${car.image}" class="card-img-top" alt="${car.name}">
                          <div class="card-body">
                            <h6 class="card-title">${car.name}</h6>
                            <span class="badge bg-info">Rick and Morty</span>
                          </div>
                        </div>
                      </div>
                    `);
                });
            });
        }
        getRick(rickPage);
        $("#rick-prev").click(()=>{ if(rickPage>1){ rickPage--; getRick(rickPage);} });
        $("#rick-next").click(()=>{ rickPage++; getRick(rickPage); });

        // Pokémon
        let pokeOffset = 0, pokeLimit = 20;
        function getPoke(offset){
            $.ajax({
                method: "GET", dataType: "json",
                url: `https://pokeapi.co/api/v2/pokemon?limit=${pokeLimit}&offset=${offset}`
            }).done(function(data){
                $("#pokemon-section").empty();
                data.results.forEach(poke=>{
                    $.ajax({
                        method: "GET", dataType: "json",
                        url: poke.url
                    }).done(function(detail){
                        $("#pokemon-section").append(`
            <div class="col-md-3 col-sm-6 mb-3">
              <div class="card shadow-sm" data-api="poke" data-id="${detail.id}">
                <img src="${detail.sprites.front_default}" class="card-img-top" alt="${detail.name}">
                <div class="card-body">
                  <h6 class="card-title">${detail.name}</h6>
                  <span class="badge bg-success">Pokémon</span>
                </div>
              </div>
            </div>
          `);
                    });
                });
            });
        }
        getPoke(pokeOffset);
        $("#poke-prev").click(()=>{ if(pokeOffset>=pokeLimit){ pokeOffset-=pokeLimit; getPoke(pokeOffset);} });
        $("#poke-next").click(()=>{ pokeOffset+=pokeLimit; getPoke(pokeOffset); });

        // Modal con datos organizados
        $(document).on("click",".card",function(){
            let api = $(this).data("api");
            let id = $(this).data("id");
            let url = api==="rick" ?
                `https://rickandmortyapi.com/api/character/${id}` :
                `https://pokeapi.co/api/v2/pokemon/${id}`;

            $.ajax({ method:"GET", dataType:"json", url:url })
                .done(function(data){
                    $("#modal-title").text("Detalle del Personaje");
                    $("#modal-name").text(data.name);
                    $("#modal-img").attr("src", api==="rick" ? data.image : data.sprites.front_default);
                    $("#modal-universe").text(api==="rick" ? "Rick and Morty" : "Pokémon");

                    let extraHtml = "";
                    if(api==="rick"){
                        extraHtml += `<p><strong>Estado:</strong> ${data.status}</p>`;
                        extraHtml += `<p><strong>Especie:</strong> ${data.species}</p>`;
                        extraHtml += `<p><strong>Origen:</strong> ${data.origin.name}</p>`;
                    } else {
                        extraHtml += `<p><strong>ID:</strong> ${data.id}</p>`;
                        extraHtml += `<p><strong>Altura:</strong> ${data.height}</p>`;
                        extraHtml += `<p><strong>Peso:</strong> ${data.weight}</p>`;
                        extraHtml += `<p><strong>Tipos:</strong> ${data.types.map(t=>t.type.name).join(", ")}</p>`;
                    }
                    $("#modal-extra").html(extraHtml);

                    new bootstrap.Modal(document.getElementById('detailModal')).show();
                });
        });

    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
